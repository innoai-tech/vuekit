class E extends TypeError{constructor(t,n){let r;const{message:i,explanation:o,...f}=t,{path:c}=t,a=c.length===0?i:`At path: ${c.join(".")} -- ${i}`;super(o??a),o!=null&&(this.cause=a),Object.assign(this,f),this.name=this.constructor.name,this.failures=()=>r??(r=[t,...n()])}}function W(e){return p(e)&&typeof e[Symbol.iterator]=="function"}function p(e){return typeof e=="object"&&e!=null}function $(e){if(Object.prototype.toString.call(e)!=="[object Object]")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}function y(e){return typeof e=="symbol"?e.toString():typeof e=="string"?JSON.stringify(e):`${e}`}function k(e){const{done:t,value:n}=e.next();return t?void 0:n}function F(e,t,n,r){if(e===!0)return;e===!1?e={}:typeof e=="string"&&(e={message:e});const{path:i,branch:o}=t,{type:f}=n,{refinement:c,message:a=`Expected a value of type \`${f}\`${c?` with refinement \`${c}\``:""}, but received: \`${y(r)}\``}=e;return{value:r,type:f,refinement:c,key:i[i.length-1],path:i,branch:o,...e,message:a}}function*w(e,t,n,r){W(e)||(e=[e]);for(const i of e){const o=F(i,t,n,r);o&&(yield o)}}function*j(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{path:r=[],branch:i=[e],coerce:o=!1,mask:f=!1}=n,c={path:r,branch:i};if(o&&(e=t.coercer(e,c),f&&t.type!=="type"&&p(t.schema)&&p(e)&&!Array.isArray(e)))for(const s in e)t.schema[s]===void 0&&delete e[s];let a="valid";for(const s of t.validator(e,c))s.explanation=n.message,a="not_valid",yield[s,void 0];for(let[s,d,S]of t.entries(e,c)){const A=j(d,S,{path:s===void 0?r:[...r,s],branch:s===void 0?i:[...i,d],coerce:o,mask:f,message:n.message});for(const h of A)h[0]?(a=h[0].refinement!=null?"not_refined":"not_valid",yield[h[0],void 0]):o&&(d=h[1],s===void 0?e=d:e instanceof Map?e.set(s,d):e instanceof Set?e.add(d):p(e)&&(d!==void 0||s in e)&&(e[s]=d))}if(a!=="not_valid")for(const s of t.refiner(e,c))s.explanation=n.message,a="not_refined",yield[s,void 0];a==="valid"&&(yield[void 0,e])}class l{assert(t,n){return I(t,this,n)}create(t,n){return P(t,this,n)}is(t){return O(t,this)}mask(t,n){return J(t,this,n)}validate(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return m(t,this,n)}constructor(t){const{type:n,schema:r,validator:i,refiner:o,coercer:f=a=>a,entries:c=function*(){}}=t;this.type=n,this.schema=r,this.entries=c,this.coercer=f,i?this.validator=(a,s)=>w(i(a,s),s,this,a):this.validator=()=>[],o?this.refiner=(a,s)=>w(o(a,s),s,this,a):this.refiner=()=>[]}}function I(e,t,n){const r=m(e,t,{message:n});if(r[0])throw r[0]}function P(e,t,n){const r=m(e,t,{coerce:!0,message:n});if(r[0])throw r[0];return r[1]}function J(e,t,n){const r=m(e,t,{coerce:!0,mask:!0,message:n});if(r[0])throw r[0];return r[1]}function O(e,t){return!m(e,t)[0]}function m(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=j(e,t,n),i=k(r);return i[0]?[new E(i[0],function*(){for(const f of r)f[0]&&(yield f[0])}),void 0]:[void 0,i[1]]}function b(e,t){return new l({type:e,schema:null,validator:t})}function M(){return b("any",()=>!0)}function N(){return b("boolean",e=>typeof e=="boolean")}function q(e){const t={},n=e.map(r=>y(r)).join();for(const r of e)t[r]=r;return new l({type:"enums",schema:t,validator(r){return e.includes(r)||`Expected one of \`${n}\`, but received: ${y(r)}`}})}function v(e){return new l({...e,validator:(t,n)=>t===void 0||e.validator(t,n),refiner:(t,n)=>t===void 0||e.refiner(t,n)})}function z(){return b("string",e=>typeof e=="string"||`Expected a string, but received: ${y(e)}`)}function B(){return b("unknown",()=>!0)}function C(e,t,n){return new l({...e,coercer:(r,i)=>O(r,t)?e.coercer(n(r,i),i):e.coercer(r,i)})}function D(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return C(e,B(),r=>{const i=typeof t=="function"?t():t;if(r===void 0)return i;if(!n.strict&&$(r)&&$(i)){const o={...r};let f=!1;for(const c in i)o[c]===void 0&&(o[c]=i[c],f=!0);if(f)return o}return r})}function G(e,t,n){return new l({...e,*refiner(r,i){yield*e.refiner(r,i);const f=w(n(r,i),i,e,r);for(const c of f)yield{...c,refinement:t}}})}class u extends l{static from(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new u({type:t.type,schema:t.schema||n.schema,entries:t.entries??n.entries,coercer:t.coercer??n.coercer,validator:t.validator??n.validator,refiner:t.refiner??n.refiner,meta:{...(t==null?void 0:t.meta)??{},...n.meta??{}}})}static define(t,n){return new u({type:t,schema:null,validator:n})}static refine(t,n,r){return u.callWith(t,G,n,r)}static callWith(t,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];return u.from(n(t,...i),{meta:t.meta})}optional(){return u.callWith(this,v)}default(t){return u.callWith(this,D,t)}use(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.reduce((i,o)=>o(i),this)}constructor({coercer:t,entries:n,validator:r,refiner:i,meta:o,...f}){super({...f,coercer:g(()=>this,t),validator:g(()=>this,r),refiner:g(()=>this,i)}),this.meta=o??{},this.entries=n?g(()=>this,n):function*(){}}}function g(e,t){if(t)return(n,r,i)=>t(n,r,i??e())}const H=()=>u.from(M()),K=()=>u.from(z()),L=()=>u.from(N());function Q(e){return u.from(q(e))}function R(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"custom";return u.define(t,e??(()=>!0))}export{H as a,L as b,R as c,Q as e,K as s};
