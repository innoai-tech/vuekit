import{c as e,I as t,j as n,a as a,r as r,s as i,b as l,d as o,e as s,f as d,T as p,F as c,o as u,t as h,g as y}from"./lib-nodepkg-vuekit.Dm8KS4WA.chunk.js";import{J as m,o as f,g as x,S as v,a as b,b as g,r as w,s as N,E as C}from"./lib-nodepkg-typedef.D_2ZclcF.chunk.js";import{s as $,a as k,P as S,v as E,b as O,B as T}from"./lib-nodepkg-vueuikit.1Scv5gVY.chunk.js";import{I as I,a as D}from"./lib-nodepkg-vuematerial.DHoaOCHI.chunk.js";import{m as A,a as L,b as R,c as P,d as J}from"./webapp-vuekit-layout.B5lkq4ob.chunk.js";import{O as M,s as B,m as _,f as j,d as W,t as z,E as H,c as V,B as F,S as U}from"./vendor-rxjs.Dumdyjy0.chunk.js";import{g as K,i as X,a as q,b as G,s as Q,l as Y,c as Z,d as ee,e as et,f as en}from"./vendor-innoai-tech-lodash.BpbPwozA.chunk.js";import{M as ea}from"./lib-nodepkg-vuemarkdown.DKUGCSKB.chunk.js";var er,ei,el,eo,es,ed=((er=ed||{}).NONE="NONE",er.ADD="ADD",er.EDIT="EDIT",er.DELETE="DELETE",er);class ep extends M{constructor(e,t){super(e=>{let t=this.#e.subscribe(e);return()=>{t.unsubscribe()}}),this.typedef=e,this.initials=t,this.#e.next(t)}static of(e,t){return new ep(e,t??("array"==e.type?[]:{}))}#e=new t({});initialsAt(e){return K(this.initials,e)}dirty(e,t){if(!X(e)){let n=K(this.initials,t);if(q(n)&&!q(e))return"ADD";if(!q(n)&&q(e))return"DELETE";if(!q(n)&&!q(e)&&n!==e)return"EDIT"}return"NONE"}update(e,t,n){if(this.#t.next({}),0==e.length)return void this.#e.next(t);G(t)?this.#e.next(a=>{let r=K(a,e,n);t(r),Q(a,e,r)}):this.#e.next(n=>{Q(n,e,t)})}delete(e){0!=e.length&&this.#e.next(t=>{let n=Y(e);if(Z(n)){let a=e.slice(0,e.length-1),r=a.length>0?K(t,a):t;if(ee(r))return void r.splice(n,1)}let a=e.slice(0,e.length-1),r=a.length>0?K(t,a):t;delete r[n]})}#t=new t({});get error$(){return this.#t}setError(e,t){let n=m.create(e);this.#t.next(e=>{null===t?delete e[n]:e[n]=t})}}let ec=e(()=>new ep(f(),{})),eu=e(()=>({})),eh=$("span",{displayName:"ActionToolbar"})({px:2,pos:"relative",display:"flex",alignItems:"center",gap:8,visibility:"hidden"}),ey=$("span",({},{slots:e})=>t=>n(t,{children:n(eh,{"data-visible-on-hover":!0,children:e.default?.()})}),{displayName:"Actions"})({display:"flex"}),em=$(I,{displayName:"ActionBtn"})({transition:"none",width:24,height:24,rounded:12,[`& ${D}`]:{svg:{width:18,height:18}}});class ef extends t{static from(e){let t=new ef(!1);return r(e,B(e=>e?_(r(j(e,"focus"),z(()=>{t.show()})),r(j(e,"blur"),W(200),z(()=>{t.value&&t.hide()}))):H),i()),t}show(){this.next(!0)}hide(){this.next(!1)}}let ex=k({apply({elements:e,rects:t}){Object.assign(e.floating.style,{width:`${t.reference.width}px`})}}),ev=a((e,{emit:t,slots:a,render:i})=>{let l=e.open$??new ef(!1),o=e=>{let n=[e.target,...e.composedPath()].find(e=>e?.hasAttribute?.("data-value"));if(n){let e=n.getAttribute("data-value");q(e)||(t("selected",e),l.hide())}};return r(l,i(e=>n(S,{isOpen:e,onClickOutside:()=>l.hide(),onEscKeydown:()=>l.hide(),placement:"bottom-start",middleware:[ex],$content:n(eb,{onClick:o,children:a.content?.()}),children:a.default?.()?.[0]??null})))},{displayName:"Menu",props:["open$"],emits:["selected"]});a((e,{slots:t,render:a})=>{let i=e.open$??new ef(!1);return r(i,a(e=>n(S,{isOpen:e,onClickOutside:()=>i.hide(),placement:"bottom-start",$content:n(eb,{children:t.content?.()}),children:t.default?.()?.[0]??null})))},{displayName:"Popover",props:["open$"]});let eb=$("div",{displayName:"PopoverContainer"})({textStyle:"sys.body-small",pos:"relative",roundedBottom:"sm",containerStyle:"sys.surface-container-lowest",borderBottom:"1px solid",borderRight:"1px solid",borderLeft:"1px solid",borderColor:E("sys.outline-variant",O(.38))}),eg=$("div",{displayName:"MenuItem"})({px:8,py:2,gap:8,display:"flex",alignItems:"center",justifyContent:"space-between",textAlign:"right",textStyle:"sys.body-small",cursor:"pointer",_hover:{containerStyle:"sys.surface-container"},_focus:{containerStyle:"sys.surface-container",outline:0}}),ew=a((e,{slots:t,render:a})=>{let i=new ef(!1);return r(i,a(a=>{let r=t.default?.()[0];return n(S,{isOpen:a,placement:e.placement??"left",$content:n(eC,{children:n(eN,{children:t.title()})}),children:r?l(r,{onMouseover:()=>{i.show()},onMouseout:()=>{i.hide()}}):null})}))},{displayName:"Tooltip",props:["placement"]}),eN=$("div",{displayName:"TooltipContainer"})({py:4,px:12,rounded:"xs",shadow:"3",textStyle:"sys.body-small",containerStyle:"sys.on-surface",pos:"relative",zIndex:100}),eC=$("div",{displayName:"TooltipWrapper"})({px:8}),e$=$("span",{displayName:"Token"})({textStyle:"sys.label-small",fontWeight:"bold",fontFamily:"inherit",fontSize:12,lineHeight:24,wordBreak:"keep-all",whiteSpace:"nowrap",font:"code",opacity:.3}),ek=a((e,{slots:t})=>()=>o(eE,{"data-deprecated":e.deprecated,"data-optional":e.optional,"data-nullable":e.nullable,children:[t.leading&&n(eS,{"data-visible-on-hover":!0,children:t.leading()}),t.default?.()]}),{displayName:"PropName",props:["deprecated","optional","nullable"]}),eS=$(eh,{displayName:"PropLeading"})({position:"absolute",ml:-28}),eE=$("div",{displayName:"PropNameView"})({position:"relative",display:"flex",alignItems:"center",textStyle:"sys.label-small",fontWeight:"bold",fontFamily:"inherit",wordBreak:"keep-all",whiteSpace:"nowrap",border:"1px solid",borderColor:"rgba(0,0,0,0)",fontSize:12,lineHeight:24,_deprecated:{textDecoration:"line-through"},_optional:{"&:after":{content:'"?"',color:"sys.secondary",opacity:.58}}}),eO=$("div",{displayName:"LineTitle"})({position:"absolute",zIndex:1,left:0,opacity:.58,fontSize:10,lineHeight:10,top:0,"& > *":{display:"flex",alignItems:"center",gap:4,"&::before":{content:'"// "',font:"code"}}}),eT=$("div",{displayName:"LineError"})({display:"block",fontSize:10,lineHeight:14,color:"sys.error"}),eI=$("div",{displayName:"LineContainer"})({position:"relative",py:4,_hover:{containerStyle:"sys.surface-container","& [data-visible-on-hover]":{visibility:"visible"}},"&:focus-within":{containerStyle:"sys.surface-container"},[`&[data-dirty=${ed.EDIT}]`]:{bgColor:E("sys.warning-container",O(.28))},[`&[data-dirty=${ed.ADD}]`]:{bgColor:E("sys.success-container",O(.28))},[`&[data-dirty=${ed.DELETE}]`]:{bgColor:E("sys.error-container",O(.28)),textDecoration:"line-through",opacity:.58},_error:{bgColor:"sys.error-container"},[`&:has(${ey})`]:{[`& > ${eT}`]:{display:"none"},_error:{bgColor:"inherit"}}}),eD=e(()=>({indent:0,$container:s(null)}),{name:"IntentContext"}),eA=d((e,{slots:t})=>{let a=eD.use(),r=s(null),i=s(null);return()=>o(c,{children:[n(e$,{children:e.openToken}),t.leading?.(),o(p,{to:a.$container.value,children:[o(eP,{"data-indent":a.indent,children:[n(eR,{ref:r}),n(eJ,{ref:i}),i.value&&n(eD,{value:{$container:i,indent:1+(a.indent??0)},children:t.trailing?.()})]}),n(eM,{style:{paddingLeft:`${32*a.indent}px`,display:"flex"},children:n(e$,{children:e.closeToken})})]}),r.value&&n(eD,{value:{$container:r,indent:1+(a.indent??0)},children:t.default?.()})]})},{displayName:"Block",props:["openToken","closeToken"]}),eL=a((e,{slots:t,render:a})=>{let i=eD.use(),l=r(ec.use().error$,a(a=>{let r=m.create(e.path),l=!e.viewOnly&&!!a[r];return o(eI,{"data-error":l,"data-dirty":e.dirty,style:{paddingLeft:`${32*i.indent}px`},children:[(e.title||e.description)&&n(eO,{style:{paddingLeft:`${32*i.indent}px`},children:e.description?n(ew,{$title:n(eB,{children:n(ea,{text:e.description})}),children:o("div",{children:[e.title," ",n(D,{path:A})]})}):n("span",{children:e.title})}),n(eM,{children:t.default?.()}),l&&n(eT,{children:`${a[r]}`})]})}));return()=>n(p,{to:i.$container.value,children:l})},{displayName:"Line",props:["path","dirty","viewOnly","title","description"]}),eR=$("div",{displayName:"Lines"})({}),eP=$("section",{displayName:"LineSection"})({}),eJ=$("div",{displayName:"LinesTrailing"})({}),eM=$("div",{displayName:"LineRow"})({display:"flex",alignItems:"start",pr:10}),eB=$("span",{displayName:"Description"})({display:"block",textStyle:"sys.body-small","& p":{my:1,wordBreak:"keep-all",whiteSpace:"nowrap",opacity:.7},"& code":{wordBreak:"keep-all",whiteSpace:"nowrap"}}),e_=$("form",{displayName:"FormControls"})({display:"flex",pos:"absolute",right:0,bottom:0,px:8});$("div",{displayName:"FormContainer"})({display:"flex",flexDirection:"column",pos:"relative",textarea:{minW:400,outline:"none",border:"none",bg:"none",py:8,px:12}}),$("div",{displayName:"FormContainerAsRow"})({display:"flex",alignItems:"center",gap:8,pos:"relative",px:8,input:{outline:"none",border:"none",bg:"none",minWidth:"10vw",py:8,px:12},[`& ${e_}`]:{pos:"relative",px:0}});let ej=x(function(){if(es)return eo;es=1;var e=el?ei:(el=1,ei=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var t=document.activeElement,n=[],a=0;a<e.rangeCount;a++)n.push(e.getRangeAt(a));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null}return e.removeAllRanges(),function(){"Caret"===e.type&&e.removeAllRanges(),e.rangeCount||n.forEach(function(t){e.addRange(t)}),t&&t.focus()}}),t={"text/plain":"Text","text/html":"Url",default:"Text"};return eo=function(n,a){var r,i,l,o,s,d,p,c,u=!1;a||(a={}),l=a.debug||!1;try{if(s=e(),d=document.createRange(),p=document.getSelection(),(c=document.createElement("span")).textContent=n,c.ariaHidden="true",c.style.all="unset",c.style.position="fixed",c.style.top=0,c.style.clip="rect(0, 0, 0, 0)",c.style.whiteSpace="pre",c.style.webkitUserSelect="text",c.style.MozUserSelect="text",c.style.msUserSelect="text",c.style.userSelect="text",c.addEventListener("copy",function(e){if(e.stopPropagation(),a.format)if(e.preventDefault(),void 0===e.clipboardData){l&&console.warn("unable to use e.clipboardData"),l&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var r=t[a.format]||t.default;window.clipboardData.setData(r,n)}else e.clipboardData.clearData(),e.clipboardData.setData(a.format,n);a.onCopy&&(e.preventDefault(),a.onCopy(e.clipboardData))}),document.body.appendChild(c),d.selectNodeContents(c),p.addRange(d),!document.execCommand("copy"))throw Error("copy command was unsuccessful");u=!0}catch(e){l&&console.error("unable to copy using execCommand: ",e),l&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(a.format||"text",n),a.onCopy&&a.onCopy(window.clipboardData),u=!0}catch(e){l&&console.error("unable to copy using clipboardData: ",e),l&&console.error("falling back to prompt"),r="message"in a?a.message:"Copy to clipboard: #{key}, Enter",i=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C",o=r.replace(/#{\s*key\s*}/g,i),window.prompt(o,n)}}finally{p&&("function"==typeof p.removeRange?p.removeRange(d):p.removeAllRanges()),c&&document.body.removeChild(c),s()}return u}}()),eW=a((e,{})=>()=>n(ew,{$title:"复制当前节点为 JSON 字符串",children:n(em,{type:"button",onClick:()=>ej(JSON.stringify(e.value,null,2)),children:n(D,{path:L})})}),{displayName:"CopyAsJSONIconBtn",props:["value"]});class ez extends F{static from(e){let t=new ez("");return r(e,B(e=>e?r(j(e,"input"),z(e=>{t.next(e.target.value.trim())})):H),i()),t}}class eH extends U{static from(e){let t=new eH;return r(e,B(e=>e?_(r(j(e,"keypress"),z(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),t.next({type:"COMMIT"}))})),r(j(e,"keydown"),z(e=>{switch(e.key){case"Tab":case"ArrowDown":e.target.getAttribute("data-options")&&(e.preventDefault(),t.next({type:"SELECT",direction:1}));break;case"ArrowUp":e.target.getAttribute("data-options")&&(e.preventDefault(),t.next({type:"SELECT",direction:-1}))}})),r(j(e,"keyup"),z(e=>{"Escape"===e.key&&t.next({type:"CANCEL"})}))):H),i()),t}}class eV extends M{static sync(e,t){return r(_(r(e,z(e=>{e&&e==m.create(t.path())&&t.editing$.show()})),r(t.editing$,W(1),z(n=>{n||e.disable(t.path())})),r(V([t.value$,e]),W(1),z(([n,a])=>{q(n)&&!a&&e.enable(t.path())}))),i())}#n=new F(null);constructor(){super(e=>{let t=this.#n.subscribe(e);return()=>t.unsubscribe()})}enable(e){this.#n.value||this.#n.next(m.create(e))}disable(e){this.#n.value===m.create(e)&&this.#n.next(null)}}let eF=e(()=>new eV),eU=a((e,{render:a})=>{let l,s=u(null),d=u(null),p=u(null),c=eH.from(p),y=ez.from(p),m=eF.use(),f=ef.from(p),x=ec.use();eV.sync(m,{editing$:f,value$:e.value$,path:()=>e.ctx.path});let b=()=>{if("enums"===e.typedef.type){let t=(v.schemaProp(e.typedef,"enum")??[]).indexOf(e.value);if(t>-1)return t}return 0},g=new t({index:b()}),w=()=>{y.next(""),f.hide()},N=t=>{if("enums"===e.typedef.type){let n=v.schemaProp(e.typedef,"enum")??[];t??=n[g.value.index%n.length]}else t??=p.value?.value?p.value?.value:void 0;if(q(t))return void x.delete(e.ctx.path);let[n,a]=e.typedef.validate(t,{coerce:!0});if(n)return void x.setError(e.ctx.path,n.message);x.update(e.ctx.path,a),w()};return(e.allowRawJSON&&r(y,z(t=>{let n=t.trim();if(n.startsWith("{")&&n.endsWith("}")||n.startsWith("[")&&n.endsWith("]"))try{let t=JSON.parse(n);x.update(e.ctx.path,t),w()}catch(t){x.setError(e.ctx.path,"无效的 JSON 字符串")}}),i()),r(c,z(t=>{switch(t.type){case"SELECT":g.next(e=>{e.index+=t.direction});break;case"COMMIT":N();break;case"CANCEL":w(),g.next({index:b()}),q(e.value)&&x.delete(e.ctx.path)}}),i()),r(_(r(d,h(e=>{if(e){let t=new ResizeObserver(e=>{for(let t of e)t.contentBoxSize&&(l=t.contentBoxSize[0]?.blockSize)});return t.observe(e),()=>{t.disconnect()}}return()=>{}})),r(p,W(1),z(e=>{e&&(e?.focus(),e.value&&(e.selectionStart=0,e.selectionEnd=e.value.length))})),r(p,B(e=>{if(e){let t=l?l-2:e.getBoundingClientRect().height,n=e=>{e.style.height=`${t??0}px`,e.style.height=`${e.scrollHeight}px`};return setTimeout(()=>n(e)),_(r(j(e,"blur"),z(t=>{t.relatedTarget&&(d.value?.contains(t.relatedTarget)||s.value?.contains(t.relatedTarget))||(t.preventDefault(),N(e.value))})),r(j(e,"input"),z(e=>{n(e.target),y.next(e.target.value)})))}return H}))),i()),"enums"==e.typedef.type)?r(V([e.value$,f,g]),a(([t,a,{index:r}])=>{let i=v.schemaProp(e.typedef,"enum")??[],l=v.metaProp(e.typedef,"enumLabels")??[];return n(eG,{ref:d,onClick:()=>{f.show()},"data-type":typeof t,tabindex:0,children:a?n(ev,{onSelected:e=>{N(e)},open$:f,$content:n("div",{ref:s,children:i.map((e,t)=>n(eY,{"data-focus":r%i.length===t,value:e,label:l[t]}))}),children:n(eX,{children:n("input",{value:void 0==t?"":`${t}`,ref:p,"data-options":!0})})}):n(eq,{children:JSON.stringify(t)??"undefined"})})})):r(V([e.value$,f]),a(([t,a])=>n(eG,{ref:d,onClick:()=>{e.ctx.readOnly||f.show()},onFocus:()=>{e.ctx.readOnly||f.show()},"data-type":typeof t,tabindex:0,children:a?n(S,{isOpen:!0,placement:"right-start",$content:o(eK,{ref:s,children:[n(em,{type:"button",onClick:()=>c.next({type:"CANCEL"}),children:n(D,{path:R})}),n(em,{type:"button",onClick:()=>c.next({type:"COMMIT"}),children:n(D,{path:P})})]}),children:n(eX,{children:n("textarea",{ref:p,rows:1,value:void 0==t?"":`${t}`})})}):n(eq,{children:JSON.stringify(t)??"undefined"})})))},{displayName:"ValueInput",props:["typedef","ctx","value","allowRawJSON"]}),eK=$("div",{displayName:"ValueInputActions"})({borderRight:"1px solid",borderTop:"1px solid",borderBottom:"1px solid",borderColor:E("sys.outline-variant",O(.38)),containerStyle:"sys.surface-container-lowest",roundedRight:"sm",display:"flex",px:2,py:0,ml:-4}),eX=$("div",{displayName:"InputWrapper"})({width:"100%",maxWidth:"40vw",display:"flex",alignItems:"center",border:"1px solid",overflow:"hidden",borderColor:E("sys.outline-variant",O(.38)),opacity:.38,"&:hover":{opacity:1},"&:focus-within":{opacity:1},"& > textarea,input":{flex:1,rounded:"xs",containerStyle:"sys.surface-container-lowest",width:"100%",outline:"none",border:"none",px:8,py:0,m:0,fontSize:"inherit",color:"inherit",lineHeight:"inherit",overflow:"hidden",resize:"none","&[data-options]:focus":{roundedBottom:0}}}),eq=$("div",{displayName:"Value"})({border:"1px solid",borderColor:"rgba(0,0,0,0)",maxWidth:"40vw",width:"100%",overflow:"hidden",textOverflow:"ellipsis",_hover:{textOverflow:"clip",whiteSpace:"normal",wordBreak:"break-all"}}),eG=$("div",{displayName:"ValueContainer"})({wordBreak:"keep-all",whiteSpace:"nowrap",cursor:"pointer",display:"flex",alignItems:"center",font:"code",width:"100%",textStyle:"sys.label-small",fontSize:12,lineHeight:24,gap:8,_type__string:{color:"sys.primary"},_type__number:{color:"sys.primary"},_type__boolean:{color:"sys.warning"},_type__undefined:{color:"sys.error"}}),eQ=$(eg,{displayName:"EnumMenuItemContainer"})({[`& ${ek}`]:{textAlign:"left"}}),eY=d(e=>()=>o(eQ,{"data-value":e.value,tabindex:0,children:[n(ek,{children:e.value}),e.label&&n(eB,{children:e.label})]}),{displayName:"EnumMenuItem",props:["value","label"]}),eZ=a(({},{emit:e})=>()=>n(ew,{$title:"删除属性",children:n(em,{type:"button",onClick:()=>e("remove"),children:n(D,{path:J})})}),{displayName:"RemovePropIconBtn",emits:["remove"]}),e0=a((e,{render:t})=>{let a=ec.use(),i=eu.use();return r(e.value$,t(t=>n(eA,{openToken:"{",closeToken:"}",$leading:n(ey,{children:n(eW,{value:t})}),$trailing:n(e1,{ctx:e.ctx,onAdd:t=>{a.update([...e.ctx.path,t],void 0)},options:[...e.typedef.entries(t,e.ctx)].filter(([e])=>!Object.hasOwn(t,e)).map(([e,t,n])=>({propName:String(e),typedef:n}))},"prop-input"),children:[...e.typedef.entries(t,e.ctx)].map(([r,l,s])=>{if(!Object.hasOwn(t,r))return null;let d=[...e.ctx.path,r];return o(eL,{path:d,dirty:a.dirty(l,d),title:v.metaProp(s,"title"),description:v.metaProp(s,"description"),children:[n(ek,{deprecated:v.schemaProp(s,"deprecated"),$leading:n(eZ,{onRemove:()=>{a.delete(d)}}),children:String(r)}),o(e$,{children:[":","\xa0"]}),i.$value?.(s,l,{...e.ctx,path:d,branch:[...e.ctx.branch,l]})]})})})))},{displayName:"ObjectInput",props:["typedef","ctx","value"]}),e1=a((e,{emit:a,render:l})=>{let s=u(null),d=eH.from(s),p=ez.from(s),c=ef.from(s),h=ec.use(),y=new t({index:0}),m=()=>{c.hide(),p.next(""),s.value&&(s.value.value="",s.value.blur()),y.next({index:0})};r(p,z(t=>{let n=t.trim();if(n.startsWith("{")&&n.endsWith("}"))try{let t=JSON.parse(n);h.update(e.ctx.path,t),m()}catch(t){h.setError(e.ctx.path,"无效的 JSON 字符串")}}),i());let f=t=>{e.options?t??=e.options[y.value.index%e.options.length]?.propName:t??=p.value,t?(a("add",t),m()):h.setError([...e.ctx.path,v.RecordKey],"无效的属性值")};r(d,z(e=>{switch(e.type){case"SELECT":y.next(t=>{t.index+=e.direction});break;case"COMMIT":f();break;case"CANCEL":m()}}),i());let x=r(c,l(e=>n(eX,{children:n("input",{ref:s,type:"text",placeholder:"添加属性 (可粘贴 JSON 字符串)","data-options":e})})));return r(V([p,c,y,e.options$]),l(([t,a,r,i])=>i?i.length>0?n(eL,{path:e.ctx.path,children:n(eG,{sx:{mx:-4},children:n(ev,{onSelected:e=>{f(e)},open$:c,$content:n("div",{children:i.map((e,a)=>t&&!e.propName.includes(t)?null:n(e2,{propName:e.propName,typedef:e.typedef,"data-focus":a===r.index%i.length}))}),children:x})})}):null:n(eL,{path:[...e.ctx.path,v.RecordKey],children:n(eG,{sx:{mx:-4},children:n(S,{isOpen:a,placement:"right-start",$content:o(eK,{children:[n(em,{type:"button",onClick:()=>d.next({type:"CANCEL"}),children:n(D,{path:R})}),n(em,{type:"button",onClick:()=>d.next({type:"COMMIT"}),children:n(D,{path:P})})]}),children:n(eX,{children:n("input",{ref:s,type:"text",placeholder:"添加属性 (可粘贴 JSON 字符串)"})})})})})))},{displayName:"PropValueInput",props:["ctx","options"],emits:["add"]}),e2=d(e=>()=>o(e8,{"data-value":e.propName,tabindex:0,children:[n(ek,{optional:v.schemaProp(e.typedef,v.optional),children:e.propName}),n(eB,{children:v.metaProp(e.typedef,"title")})]}),{displayName:"PropMenuItem",props:["propName","typedef"]}),e8=$(eg,{displayName:"AddPropMenuItemContainer"})({[`& ${ek}`]:{textAlign:"left"}}),e4=a((e,{render:t})=>{let a=ec.use(),i=eu.use();return r(e.value$,t(t=>n(eA,{openToken:"[",closeToken:"]",$leading:n(ey,{children:n(eW,{value:t})}),$trailing:n(e3,{ctx:e.ctx,typedef:e.typedef,onAdd:t=>{a.update(e.ctx.path,e=>{e.push(t)},[])}}),children:[...e.typedef.entries(t,e.ctx)].map(([t,r,l])=>{let s=[...e.ctx.path,t];return o(eL,{path:s,dirty:a.dirty(r,s),children:[n(ek,{$leading:n(e5,{onRemove:()=>{a.delete(s)}}),children:n(T,{sx:{opacity:.3,mr:"0.5em"},children:String(t)})}),i.$value?.(l,r,{...e.ctx,path:s,branch:[...e.ctx.branch,r]})]})})})))},{displayName:"ArrayInput",props:["ctx","value","typedef"]}),e3=a((e,{emit:t,render:a})=>{let l=u(null),s=ez.from(l),d=eH.from(l),p=ef.from(l),c=ec.use(),h=()=>{l.value&&(l.value.value="",l.value.blur())},y=n=>{if(n??=s.value){let[a,r]=v.schemaProp(e.typedef,"items").validate(n,{coerce:!0});if(a)return void c.setError(e.ctx.path,a);t("add",r)}else t("add",void 0);h()};r(s,z(t=>{let n=t.trim();if(n.startsWith("[")&&n.endsWith("]"))try{let t=JSON.parse(n);c.update(e.ctx.path,t),h()}catch(t){c.setError(e.ctx.path,"无效的 JSON 字符串")}if(n.startsWith("{")&&n.endsWith("}"))try{y(JSON.parse(n))}catch(t){c.setError(e.ctx.path,"无效的 JSON 字符串")}}),i()),r(d,z(e=>{switch(e.type){case"COMMIT":y();break;case"CANCEL":h()}}),i());let m=r(p,a(e=>n(S,{isOpen:e,placement:"right-start",$content:o(eK,{children:[n(em,{type:"button",onClick:()=>d.next({type:"CANCEL"}),children:n(D,{path:R})}),n(em,{type:"button",onClick:()=>d.next({type:"COMMIT"}),children:n(D,{path:P})})]}),children:n(eX,{children:n("input",{ref:l,type:"text",placeholder:"添加数组项 (可粘贴 JSON 字符串)"})})})));return()=>n(eL,{path:e.ctx.path,children:n(eG,{sx:{mx:-4},children:m})})},{displayName:"AddItemIconBtn",props:["ctx","typedef"],emits:["add"]}),e5=a(({},{emit:e})=>()=>n(ew,{$title:"移除项",children:n(em,{type:"button",onClick:()=>e("remove"),children:n(D,{path:J})})}),{displayName:"RemoteItemIconBtn",emits:["remove"]}),e7=a((e,{render:t})=>{let a=ec.use(),i=eu.use();return r(e.value$,t(t=>{let r=a.initialsAt(e.ctx.path);return n(eA,{openToken:"{",closeToken:"}",$leading:n(ey,{children:n(eW,{value:t})}),$trailing:n(e1,{ctx:e.ctx,onAdd:t=>{a.update([...e.ctx.path,t],void 0)}},"prop-input"),children:[...e.typedef.entries((()=>{let e={};for(let n of Object.keys(Object.assign({},r??{},t??{})).toSorted())e[n]=t?.[n];return e})(),e.ctx)].map(([l,s,d])=>{if(et(l))return null;let p=[...e.ctx.path,l];return o(eL,{path:p,dirty:a.dirty(s,p),children:[n(ek,{$leading:n(eZ,{onRemove:()=>{a.delete(p)}}),children:String(l)}),o(e$,{children:[":","\xa0"]}),Object.hasOwn(t,l)?i.$value?.(d,s,{...e.ctx,path:p,branch:[...e.ctx.branch,s]}):i.$value?.(d,(r??{})[l],{...e.ctx,path:p,branch:[...e.ctx.branch,(r??{})[l]],readOnly:!0})]})})})}))},{displayName:"RecordInput",props:["ctx","value","typedef"]}),e6=a((e,{render:t})=>r(e.value$,t(t=>ee(t)?n(e4,{value:t,typedef:b(g()),ctx:e.ctx}):en(t)?n(e7,{value:t,typedef:w(N(),g()),ctx:e.ctx}):n(eU,{value:t,typedef:g(),ctx:e.ctx,allowRawJSON:!0}))),{displayName:"AnyInput",props:["typedef","ctx","value"]}),e9=(e,t,a)=>{if("object"==e.type||"intersection"==e.type||"union"==e.type&&v.schemaProp(e,"discriminator"))return n(e0,{typedef:e,value:t??{},ctx:a});if("union"==e.type&&q(v.schemaProp(e,"discriminator"))){let r=v.schemaProp(e,"oneOf");if(r?.length==2){let e=r.find(e=>"array"==e.type),i=r.find(e=>"array"!=e.type);if(e&&i&&v.schemaProp(e,"items").type==i.type)return n(e4,{typedef:e,value:ee(t)?t:q(t)?[]:[t],ctx:a})}return n(eU,{typedef:e,value:t,ctx:a,allowRawJSON:!0})}return"record"==e.type?n(e7,{typedef:e,value:t,ctx:a}):"array"==e.type?n(e4,{typedef:e,value:t,ctx:a}):"any"==e.type||"unknown"==e.type?n(e6,{typedef:e,value:t,ctx:a}):n(eU,{typedef:e,value:t,ctx:a})},te=a(({},{render:e})=>{let t=ec.use(),a=eu.use(),i=y(null);return r(t,e(e=>{let r=a.$value??e9;return n(eF,{children:n(eu,{value:{$value:a.$value??e9},children:o(tt,{children:[n("section",{ref:i}),i.value&&n(eD,{value:{indent:0,$container:i},children:n(eL,{path:[],viewOnly:!0,children:r(t.typedef,e,C)})})]})})})}))},{displayName:"JSONEditorView"}),tt=$("div",{displayName:"JSONEditorContainer"})({width:"100%",height:"100%",overflow:"auto",section:{display:"flex",flexDirection:"column",minWidth:"max-content"}});export{ep as J,ec as a,te as b,ej as c};
