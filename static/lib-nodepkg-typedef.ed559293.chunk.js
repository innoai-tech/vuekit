class S extends TypeError{constructor(n,r){let t;const{message:i,explanation:s,...a}=n,{path:u}=n,f=u.length===0?i:`At path: ${u.join(".")} -- ${i}`;super(s??f),s!=null&&(this.cause=f),Object.assign(this,a),this.name=this.constructor.name,this.failures=()=>t??(t=[n,...r()])}}function E(e){return g(e)&&typeof e[Symbol.iterator]=="function"}function g(e){return typeof e=="object"&&e!=null}function b(e){if(Object.prototype.toString.call(e)!=="[object Object]")return!1;const n=Object.getPrototypeOf(e);return n===null||n===Object.prototype}function p(e){return typeof e=="symbol"?e.toString():typeof e=="string"?JSON.stringify(e):`${e}`}function W(e){const{done:n,value:r}=e.next();return n?void 0:r}function F(e,n,r,t){if(e===!0)return;e===!1?e={}:typeof e=="string"&&(e={message:e});const{path:i,branch:s}=n,{type:a}=r,{refinement:u,message:f=`Expected a value of type \`${a}\`${u?` with refinement \`${u}\``:""}, but received: \`${p(t)}\``}=e;return{value:t,type:a,refinement:u,key:i[i.length-1],path:i,branch:s,...e,message:f}}function*w(e,n,r,t){E(e)||(e=[e]);for(const i of e){const s=F(i,n,r,t);s&&(yield s)}}function*$(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{path:t=[],branch:i=[e],coerce:s=!1,mask:a=!1}=r,u={path:t,branch:i};if(s&&(e=n.coercer(e,u),a&&n.type!=="type"&&g(n.schema)&&g(e)&&!Array.isArray(e)))for(const o in e)n.schema[o]===void 0&&delete e[o];let f="valid";for(const o of n.validator(e,u))o.explanation=r.message,f="not_valid",yield[o,void 0];for(let[o,c,O]of n.entries(e,u)){const A=$(c,O,{path:o===void 0?t:[...t,o],branch:o===void 0?i:[...i,c],coerce:s,mask:a,message:r.message});for(const m of A)m[0]?(f=m[0].refinement!=null?"not_refined":"not_valid",yield[m[0],void 0]):s&&(c=m[1],o===void 0?e=c:e instanceof Map?e.set(o,c):e instanceof Set?e.add(c):g(e)&&(c!==void 0||o in e)&&(e[o]=c))}if(f!=="not_valid")for(const o of n.refiner(e,u))o.explanation=r.message,f="not_refined",yield[o,void 0];f==="valid"&&(yield[void 0,e])}class l{assert(n,r){return I(n,this,r)}create(n,r){return P(n,this,r)}is(n){return j(n,this)}mask(n,r){return v(n,this,r)}validate(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return h(n,this,r)}constructor(n){const{type:r,schema:t,validator:i,refiner:s,coercer:a=f=>f,entries:u=function*(){}}=n;this.type=r,this.schema=t,this.entries=u,this.coercer=a,i?this.validator=(f,o)=>w(i(f,o),o,this,f):this.validator=()=>[],s?this.refiner=(f,o)=>w(s(f,o),o,this,f):this.refiner=()=>[]}}function I(e,n,r){const t=h(e,n,{message:r});if(t[0])throw t[0]}function P(e,n,r){const t=h(e,n,{coerce:!0,message:r});if(t[0])throw t[0];return t[1]}function v(e,n,r){const t=h(e,n,{coerce:!0,mask:!0,message:r});if(t[0])throw t[0];return t[1]}function j(e,n){return!h(e,n)[0]}function h(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const t=$(e,n,r),i=W(t);return i[0]?[new S(i[0],function*(){for(const a of t)a[0]&&(yield a[0])}),void 0]:[void 0,i[1]]}function y(e,n){return new l({type:e,schema:null,validator:n})}function J(){return y("any",()=>!0)}function M(){return y("boolean",e=>typeof e=="boolean")}function N(e){const n={},r=e.map(t=>p(t)).join();for(const t of e)n[t]=t;return new l({type:"enums",schema:n,validator(t){return e.includes(t)||`Expected one of \`${r}\`, but received: ${p(t)}`}})}function q(e){return new l({...e,validator:(n,r)=>n===void 0||e.validator(n,r),refiner:(n,r)=>n===void 0||e.refiner(n,r)})}function z(){return y("string",e=>typeof e=="string"||`Expected a string, but received: ${p(e)}`)}function B(){return y("unknown",()=>!0)}function C(e,n,r){return new l({...e,coercer:(t,i)=>j(t,n)?e.coercer(r(t,i),i):e.coercer(t,i)})}function D(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return C(e,B(),t=>{const i=typeof n=="function"?n():n;if(t===void 0)return i;if(!r.strict&&b(t)&&b(i)){const s={...t};let a=!1;for(const u in i)s[u]===void 0&&(s[u]=i[u],a=!0);if(a)return s}return t})}function G(e,n,r){return new l({...e,*refiner(t,i){yield*e.refiner(t,i);const a=w(r(t,i),i,e,t);for(const u of a)yield{...u,refinement:n}}})}class d extends l{static define(n,r){return new d({type:n,schema:null,validator:r})}static refine(n,r,t){return d.callWith(n,G,r,t)}static callWith(n,r){for(var t=arguments.length,i=new Array(t>2?t-2:0),s=2;s<t;s++)i[s-2]=arguments[s];return new d({...r(n,...i),meta:n.meta})}optional(){return d.callWith(this,q)}default(n){return d.callWith(this,D,n)}use(){for(var n=arguments.length,r=new Array(n),t=0;t<n;t++)r[t]=arguments[t];return r.reduce((i,s)=>s(i),this)}constructor({entries:n=function*(){},coercer:r,validator:t,refiner:i,meta:s,...a}){var u;super({...a,coercer:r?function(){for(var f=arguments.length,o=new Array(f),c=0;c<f;c++)o[c]=arguments[c];return r.apply(u,o)}:void 0,validator:t?function(){for(var f=arguments.length,o=new Array(f),c=0;c<f;c++)o[c]=arguments[c];return t.apply(u,o)}:void 0,refiner:i?function(){for(var f=arguments.length,o=new Array(f),c=0;c<f;c++)o[c]=arguments[c];return i.apply(u,o)}:void 0}),u=this,this.entries=n,this.meta=s??{}}}const H=()=>new d(J()),K=()=>new d(z()),L=()=>new d(M());function Q(e){return new d(N(e))}function R(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"custom";return d.define(n,e??(()=>!0))}export{H as a,L as b,R as c,Q as e,K as s};
